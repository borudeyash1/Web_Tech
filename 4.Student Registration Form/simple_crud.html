<!DOCTYPE html>
<html>
<head>
    <title>Student Registration</title>
    <style>
        body { font-family: Arial; margin: 40px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; }
        input[type="text"], input[type="email"] { width: 100%; padding: 8px; margin-bottom: 10px; }
        .btn { padding: 10px 15px; background: #4CAF50; color: white; border: none; cursor: pointer; }
        .btn-danger { background: #f44336; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f5f5f5; }
        .message { padding: 10px; margin: 10px 0; }
        .success { background: #dff0d8; border: 1px solid #3c763d; }
        .error { background: #f2dede; border: 1px solid #a94442; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Student Registration</h2>
        
        <!-- Registration Form -->
        <form id="studentForm">
            <input type="hidden" id="studentId" name="studentId">
            <div class="form-group">
                <label>PRN:</label>
                <input type="text" id="prn" name="prn" required>
            </div>
            <div class="form-group">
                <label>Name:</label>
                <input type="text" id="name" name="name" required>
            </div>
            <div class="form-group">
                <label>Roll No:</label>
                <input type="text" id="rollno" name="rollno" required>
            </div>
            <div class="form-group">
                <label>Email:</label>
                <input type="email" id="email" name="email" required>
            </div>
            <div class="form-group">
                <label>Address:</label>
                <input type="text" id="address" name="address" required>
            </div>
            <button type="submit" class="btn">Save Student</button>
            <button type="button" onclick="resetForm()" class="btn">Clear Form</button>
        </form>

        <div id="message"></div>

        <!-- Students List -->
        <h3>Students List</h3>
        <table id="studentsTable">
            <thead>
                <tr>
                    <th>PRN</th>
                    <th>Name</th>
                    <th>Roll No</th>
                    <th>Email</th>
                    <th>Address</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>

    <script>
        // Load students on page load
        document.addEventListener('DOMContentLoaded', loadStudents);
        
        // Form submit handler
        document.getElementById('studentForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = {
                id: document.getElementById('studentId').value,
                prn: document.getElementById('prn').value,
                name: document.getElementById('name').value,
                rollno: document.getElementById('rollno').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value
            };

            // If we have an ID, it's an update; otherwise it's a create
            const method = formData.id ? 'PUT' : 'POST';
            
            fetch('simple_crud.php', {
                method: method,
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            })
            .then(response => response.json())
            .then(data => {
                showMessage(data.message, data.success ? 'success' : 'error');
                if (data.success) {
                    loadStudents();
                    resetForm();
                }
            })
            .catch(error => showMessage('Error: ' + error, 'error'));
        });

        function loadStudents() {
            fetch('simple_crud.php')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.querySelector('#studentsTable tbody');
                    tbody.innerHTML = '';
                    data.forEach(student => {
                        tbody.innerHTML += `
                            <tr>
                                <td>${student.prn}</td>
                                <td>${student.name}</td>
                                <td>${student.rollno}</td>
                                <td>${student.email}</td>
                                <td>${student.address}</td>
                                <td>
                                    <button onclick="editStudent(${JSON.stringify(student)})" class="btn">Edit</button>
                                    <button onclick="deleteStudent('${student.id}')" class="btn btn-danger">Delete</button>
                                </td>
                            </tr>
                        `;
                    });
                })
                .catch(error => showMessage('Error loading students: ' + error, 'error'));
        }

        function editStudent(student) {
            document.getElementById('studentId').value = student.id;
            document.getElementById('prn').value = student.prn;
            document.getElementById('name').value = student.name;
            document.getElementById('rollno').value = student.rollno;
            document.getElementById('email').value = student.email;
            document.getElementById('address').value = student.address;
        }

        function deleteStudent(id) {
            if (!confirm('Are you sure you want to delete this student?')) return;

            fetch('simple_crud.php', {
                method: 'DELETE',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ id: id })
            })
            .then(response => response.json())
            .then(data => {
                showMessage(data.message, data.success ? 'success' : 'error');
                if (data.success) loadStudents();
            })
            .catch(error => showMessage('Error: ' + error, 'error'));
        }

        function resetForm() {
            document.getElementById('studentForm').reset();
            document.getElementById('studentId').value = '';
        }

        function showMessage(message, type) {
            const msgDiv = document.getElementById('message');
            msgDiv.textContent = message;
            msgDiv.className = 'message ' + type;
            setTimeout(() => msgDiv.textContent = '', 5000);
        }
    </script>
</body>
</html>